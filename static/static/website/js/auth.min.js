$(function() {
	$('#login_btn').click(function() {
		$('.error-msg').html('');
		var loading_btn = '<span class="fa fa-refresh fa-spin"></span>';
		var normal_btn = '<i class="fa fa-sign-in"></i> Login';
		$('#login_btn').html(loading_btn);
		$('#login_btn').attr('disabled', 'disabled');
		var data = $("#login_form :input").serializeArray();
		console.log(data);
		if(data[1].value.length < 5){
			$('.error-msg').html('Username must have min 5 chars');
			$('#login_btn').removeAttr('disabled');
			$('#login_btn').html(normal_btn);
			return false;
		}
		else if(data[2].value.length < 8){
			$('.error-msg').html('Password must have min 8 chars');
			$('#login_btn').removeAttr('disabled');
			$('#login_btn').html(normal_btn);
			return false;
		}
		else{
			console.log('Processing Login');
			$('#login_form').submit();
		}
	});

	$('#reg_btn').click(function() {
		$('.error-msg').html('');
		var loading_btn = '<span class="fa fa-refresh fa-spin"></span>';
		var normal_btn = '<i class="fa fa-user-plus"></i> Register';
		$('#reg_btn').html(loading_btn);
		$('#reg_btn').attr('disabled', 'disabled');
		var data = $("#reg_form :input").serializeArray();
		console.log(data);
		if(data[1].value.length < 5){
			$('.error-msg').html('Username must have min 5 chars');
			$('#reg_btn').removeAttr('disabled');
			$('#reg_btn').html(normal_btn);
			return false;
		}
		else if(data[2].value.length < 8){
			$('.error-msg').html('Email must have min 8 chars');
			$('#reg_btn').removeAttr('disabled');
			$('#reg_btn').html(normal_btn);
			return false;
		}
		else if(data[3].value.length < 8){
			$('.error-msg').html('Password must have min 8 chars');
			$('#reg_btn').removeAttr('disabled');
			$('#reg_btn').html(normal_btn);
			return false;
		}
		else if(data[3].value.length < 8){
			$('.error-msg').html('Password must have min 8 chars');
			$('#reg_btn').removeAttr('disabled');
			$('#reg_btn').html(normal_btn);
			return false;
		}
		else if($('#cpassword').val().length < 8){
			$('.error-msg').html('Passwords do not match');
			$('#reg_btn').removeAttr('disabled');
			$('#reg_btn').html(normal_btn);
			return false;
		}
		else if(data[3].value != $('#cpassword').val()){
			$('.error-msg').html('Passwords do not match');
			$('#reg_btn').removeAttr('disabled');
			$('#reg_btn').html(normal_btn);
			return false;
		}
		else{
			console.log('Processing Register');
			$('#reg_form').submit();
		}
	});

	$('#step_1_btn').click(function() {
		$('.error-msg').html('');
		var loading_btn = '<span class="fa fa-refresh fa-spin"></span>';
		var normal_btn = '<i class="fa fa-arrow-right"></i> Next Step';
		if($("#female").is(":checked"))
			$('#gender').val('Female')
		$(this).html(loading_btn);
		$(this).attr('disabled', 'disabled');
		var data = $("#step_1_form :input").serializeArray();
		console.log(data);
		if(data[1].value != '' && data[1].value.match('^[a-zA-Z]{3,15}$')){
			console.log('First Name Accepted')
			$('.progress-bar').css('width','10%');
		}
		else{
			$('.error-msg').html('First Name must have (3-15) chars [a-z] or [A-Z]');
			$(this).html(normal_btn);
			$(this).removeAttr('disabled');
			return false;
		}
		if(data[2].value != '' && data[2].value.match('^[a-zA-Z]{3,15}$')){
			console.log('Last Name Accepted');
			$('.progress-bar').css('width','15%');
		}
		else{
			$('.error-msg').html('Last Name must have (3-15) chars [a-z] or [A-Z]');
			$(this).html(normal_btn);
			$(this).removeAttr('disabled');
			return false;
		}
		if(data[3].value != '' && new Date(data[3].value) != "Invalid Date"){
			console.log('Date Of Birth Accepted');
			$('.progress-bar').css('width','30%');
		}
		else{
			$('.error-msg').html('Choose a valid Date of birth (dd/mm/yyyy)');
			$(this).html(normal_btn);
			$(this).removeAttr('disabled');
			return false;
		}
		if(data[4].value != ''){
			console.log('Status Accepted');
			$('.progress-bar').css('width','50%');
		}
		else{
			$('.error-msg').html('Select your status');
			$(this).html(normal_btn);
			$(this).removeAttr('disabled');
			return false;
		}
		if(data[6].value != ''){
			console.log('Location Accepted');
			$('.progress-bar').css('width','70%');
		}
		else{
			$('.error-msg').html('Select a valid location');
			$(this).html(normal_btn);
			$(this).removeAttr('disabled');
			return false;
		}
		if(data[8].value != '' && data[8].value.length > 8){
			console.log('Profile Picture Accepted -> '+data[8].value);
			$('.progress-bar').css('width','100%');
		}
		else{
			$('.error-msg').html('Choose a valid profile pic');
			$(this).html(normal_btn);
			$(this).removeAttr('disabled');
			return false;
		}
		console.log("Updating 50% Profile Details");
		$('#step_1_form').submit();
	});

	$('#step_2_btn').click(function() {
		$('.error-msg').html('');
		var loading_btn = '<span class="fa fa-refresh fa-spin"></span>';
		var normal_btn = '<i class="fa fa-arrow-right"></i> Next Step';
		if($("#is_studying_2_check").is(":checked") && $("#is_studying_1_check").is(":checked")){
			$('.error-msg').html('Only 1 Institution can be marked for studying');
			return false
		}
		if($("#is_studying_2_check").is(":checked"))
			$('#is_studying_2').val('True')
		if($("#is_studying_1_check").is(":checked"))
			$('#is_studying_1').val('True')
		$(this).html(loading_btn);
		$(this).attr('disabled', 'disabled');
		var data = $("#step_2_form :input").serializeArray();
		// 1->2->5 and 3->4->6  -> relation
		if(data[1].value != '' && data[1].value.length > 3){
			console.log('Institution 1 Accepted -> '+data[1].value);
			$('.progress-bar').css('width','75%');
		}
		else{
			$('.error-msg').html('Provide 1st institution details');
			$(this).html(normal_btn);
			$(this).removeAttr('disabled');
			return false;
		}
		if(data[1].value != '' && data[2].value != ''){
			console.log('Institution 1 Grade Accepted -> '+data[2].value);
			$('.progress-bar').css('width','75%');
		}
		else{
			$('.error-msg').html('Provide Degree-Course for 1st Institution');
			$('.progress-bar').css('width','50%');
			$(this).html(normal_btn);
			$(this).removeAttr('disabled');
			return false;
		}
		if(data[3].value != ''){
			if(data[4].value != ''){
				console.log('Institution 2 Accepted -> '+data[3].value);
				$('.progress-bar').css('width','85%');
			}
			else{
				$('.error-msg').html('Provide Degree-Course for 2nd Institution');
				$('.progress-bar').css('width','75%');
				$(this).html(normal_btn);
				$(this).removeAttr('disabled');
				return false;
			}
		}
		if(data[7].value != ''){
			if(data[7].value.length > 50){
				console.log('Intro Accepted -> '+data[2].value);
				$('.progress-bar').css('width','75%');
			}
			else{
				$('.error-msg').html('Intro must have min 50 chars.');
				$('.progress-bar').css('width','50%');
				$(this).html(normal_btn);
				$(this).removeAttr('disabled');
				return false;
			}
		}
		console.log(data);
		console.log("Updating 100% Profile Details");
		$('#step_2_form').submit();
	});

});

$('#dp_up_btn').click(function(){
	$('#dp_up').click();
});

$('#dp').click(function(){
	$('#dp_up').click();
});
var d_link = "";

$("#dp_up").on("change", function(){
	$("#dp_up_btn").html('<i class="fa fa-refresh fa-spin"></i>');
	$("#dp_up_btn").attr('disabled', 'disabled');
	var formData = new FormData();
	formData.append('the_file', $('#dp_up')[0].files[0]);
	$.ajax({
	   url : 'http://techtrendz.in/uploads/a1df072abf2a58cfa0bd90fce5a0b65eac9e4952e7dc8c1b1dd05c24bfdb3947/upload.php',
	   type : 'POST',
	   data : formData,
	   processData: false,  // tell jQuery not to process the data
	   contentType: false,  // tell jQuery not to set contentType
	   success : function(data) {
			if(data.status == "uploaded_successfully"){
				$("#dp_up_btn").html('<i class="fa fa-check"></i>');
				$("#dp").val(data.link);
				d_link=data.link;
				$('#dp_up_img').attr('src', data.link)
			}
			else{
				alert("Failed -> ("+ data.error +") -> Default image set");
				console.log(data);
				$("#dp_up").html('<i class="fa fa-upload"></i>');
				$("#dp_up").removeAttr('disabled');
				$('#dp').val('http://techtrendz.in/uploads/a1df072abf2a58cfa0bd90fce5a0b65eac9e4952e7dc8c1b1dd05c24bfdb3947/images/default.png')
			}
	   },
	   error : function(data) {
	   	alert("Check your internet connection");
	   	$("#dp_up_btn").html('<i class="fa fa-upload"></i>');
	   	$("#dp_up_btn").removeAttr('disabled');
   	   }
	});
});

function empty(){
	$("#dp").val(d_link);
}

